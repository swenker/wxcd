create table unique_devices_byday(`deviceid` varchar(20),`event_date` date);

 select count(deviceid) from checkin_devices group by date_format(event_datetime,'%Y-%m-%d')
 
 insert into unique_devices_byday select distinct deviceid,'2016-10-07' from checkin_devices where date_format(event_datetime,'%Y-%m-%d')='2016-10-07';
 
 
select count(deviceid) from (select deviceid from unique_devices_byday where event_date='2016-10-08') not in (select deviceid from unique_devices_byday where event_date='2016-10-07'))
 
set @dt='2016-10-27';
insert into unique_devices_byday select distinct deviceid,@dt from checkin_devices where date_format(event_datetime,'%Y-%m-%d')=@dt;


innodb_buffer_pool_size=1024M
join_buffer_size=128M
query_cache_size=256M


drop table deviceid_tmp_past;
drop table deviceid_tmp_current;
create table deviceid_tmp_past(deviceid bigint);
create table deviceid_tmp_current(deviceid bigint);

INSERT INTO deviceid_tmp_past SELECT DISTINCT deviceid FROM unique_devices_byday WHERE event_date<'2016-10-10';

INSERT INTO deviceid_tmp_current select deviceid from unique_devices_byday where event_date='2016-10-10';


SELECT COUNT(*) FROM (SELECT a.deviceid AS da,b.deviceid AS db FROM (SELECT deviceid FROM deviceid_tmp_past ) a   RIGHT JOIN ( SELECT deviceid FROM deviceid_tmp_current ) b on a.deviceid=b.deviceid) c WHERE c.da IS NULL;

26149

CREATE TABLE newdevice_byday(event_date DATE,device_counter INTEGER);

SELECT COUNT(deviceid) FROM deviceid_tmp_current WHERE deviceid NOT IN (SELECT deviceid FROM deviceid_tmp_past)


INSERT INTO newdevice_byday(event_date,device_counter)VALUES('2016-10-08',26149);

TRUNCATE TABLE deviceid_tmp_past;
truncate table deviceid_tmp_current;


CREATE TABLE `m_deviceid_tmp_past` (`deviceid` bigint,primary key(deviceid)) ENGINE=MEMORY DEFAULT CHARSET=utf8;
CREATE TABLE `m_deviceid_tmp_current` (`deviceid` bigint,primary key(deviceid)) ENGINE=MEMORY DEFAULT CHARSET=utf8;


select count(deviceid) from checkin_devices where date_format(event_datetime,'%Y-%m-%d')='2016-10-30';
select count(distinct deviceid) from checkin_devices where date_format(event_datetime,'%Y-%m-%d')='2016-10-27'

insert into devices_counter_byday (event_date,unique_counter,all_counter) values('2016-10-30',210727,362890);

已经实现：
-------------
1.日新增
2.日活跃，

需要  月新增
     周新增
     月活跃
     周活跃
     日留存：
     周留存






